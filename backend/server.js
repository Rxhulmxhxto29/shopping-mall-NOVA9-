const express=require('express');const cors=require('cors');const cookieParser=require('cookie-parser');require('dotenv').config();const {initDatabase,dbWrapper,saveDatabase}=require('./config/database');const createTables=require('./models/schema');const authRoutes=require('./routes/auth');const userRoutes=require('./routes/user');const orderRoutes=require('./routes/orders');const eventRoutes=require('./routes/events');const reservationRoutes=require('./routes/reservations');const loyaltyRoutes=require('./routes/loyalty');const adminRoutes=require('./routes/admin');const app=express();app.use(cors({origin:['http://localhost:8080','http://127.0.0.1:8080','http://[::]:8080'],credentials:true,methods:['GET','POST','PUT','DELETE','OPTIONS'],allowedHeaders:['Content-Type','Authorization']}));app.use(express.json());app.use(express.urlencoded({extended:true}));app.use(cookieParser());async function startServer(){try{await initDatabase();global.db=dbWrapper;global.saveDb=saveDatabase;createTables();app.use('/api/auth',authRoutes);app.use('/api/user',userRoutes);app.use('/api/orders',orderRoutes);app.use('/api/events',eventRoutes);app.use('/api/reservations',reservationRoutes);app.use('/api/loyalty',loyaltyRoutes);app.use('/api/admin',adminRoutes);app.get('/api/health',(req,res)=>{res.json({success:true,message:'NOVA9 API is running'})});app.use((err,req,res,next)=>{console.error(err.stack);res.status(500).json({success:false,message:'Something went wrong!',error:process.env.NODE_ENV==='development'?err.message:undefined})});const PORT=process.env.PORT||5000;app.listen(PORT,()=>{console.log('NOVA9 Backend running on port '+PORT)})}catch(error){console.error('Failed to start:',error);process.exit(1)}}startServer();